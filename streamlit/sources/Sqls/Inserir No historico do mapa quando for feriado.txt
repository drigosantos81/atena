INSERT INTO CLB344173.HISTORICO_MAPA_SELECAO SELECT PRINCIPAL.UTD, PRINCIPAL.ZONA, PRINCIPAL.CARTEIRA,PRINCIPAL.TURMA,PRINCIPAL.QTD_MIN, PRINCIPAL.QTD_MAX,PRINCIPAL.ORIGN,CAST(PRINCIPAL.QTD_CLUSTER AS INT) AS QTD_CLUSTER,PRINCIPAL.RAIO_MIN,RAIO_MAX, RAIO_INC,DIA_SEMANA,DATA_PEDIDO, QTD_SUSCETIVEIS,VALOR_COBRAVEL,PECLD,TICKET_PECLD,TICKET_COBRAVEL FROM (
            SELECT 
                UTD,
                ZONA,
                CASE WHEN CARTEIRA = 'DISJUNTOR' OR CARTEIRA = 'DISJUNTOR MIX' THEN 'DISJUNTOR' 
                WHEN CARTEIRA = 'RECORTE MIX' OR CARTEIRA = 'RECORTE' THEN 'RECORTE'
                WHEN CARTEIRA = 'CONVENCIONAL' THEN 'CORTE'
                WHEN CARTEIRA = 'BAIXA MIX' OR CARTEIRA = 'BAIXA' THEN 'BAIXA' END AS CARTEIRA,
                
                TURMA,
                QTD_MIN,
                QTD_MAX,
                QTD_CLUSTERS AS ORIGN,
                CASE 
                    WHEN SUBSTRING(QTD_CLUSTERS,10,1) NOT IN ('0','1','2','3','4','5','6','7','8','9') THEN 0
                    WHEN DAYOFWEEK(ADD_DAYS(CURRENT_DATE,1)) = 6 THEN SUBSTRING(QTD_CLUSTERS,10,1) 
                    WHEN DAYOFWEEK(ADD_DAYS(CURRENT_DATE,1)) = 5 THEN SUBSTRING(QTD_CLUSTERS,8,1) 
                    WHEN DAYOFWEEK(ADD_DAYS(CURRENT_DATE,1)) = 4 THEN SUBSTRING(QTD_CLUSTERS,6,1) 
                    WHEN DAYOFWEEK(ADD_DAYS(CURRENT_DATE,1)) = 3 THEN SUBSTRING(QTD_CLUSTERS,4,1)
                    WHEN DAYOFWEEK(ADD_DAYS(CURRENT_DATE,1)) = 2 THEN SUBSTRING(QTD_CLUSTERS,2,1) END AS QTD_CLUSTER,
            RAIO_MIN,
            RAIO_MAX,
            RAIO_INC,
            DAYOFWEEK(ADD_DAYS(CURRENT_DATE,1)) AS DIA_SEMANA,
            ADD_DAYS(CURRENT_DATE,1) AS DATA_PEDIDO
            FROM CLB142840.CLUSTER_CONFIG5
            ) AS PRINCIPAL
            LEFT JOIN (SELECT 
            DATAREF,
            CASE WHEN ACAO = 'DISJ' THEN 'DISJUNTOR' ELSE ACAO END AS ACAO,
            UTD,ZONA,COUNT(SUSCETIVEIS.ZCGACCOUN) AS QTD_SUSCETIVEIS ,SUM(ZCGMTVCOB) AS VALOR_COBRAVEL, SUM(PECLD) AS PECLD, (SUM(PECLD)/COUNT(SUSCETIVEIS.ZCGACCOUN)) AS TICKET_PECLD, (SUM(ZCGMTVCOB)/COUNT(SUSCETIVEIS.ZCGACCOUN)) AS TICKET_COBRAVEL FROM CLB961920.SUSCETIVEIS
            LEFT JOIN (SELECT ZCGVKONT AS ZCGACCOUN, SUM(ZCGPECLDALOC) AS PECLD
            FROM CLB_CCS_ICC.ZCT_DS_CARGA_AGING_COELBA
            GROUP BY ZCGVKONT) AS PDD
            ON PDD.ZCGACCOUN = SUSCETIVEIS.ZCGACCOUN
            WHERE ZONA IS NOT NULL
            GROUP BY DATAREF,ACAO,UTD,ZONA) AS DADOS_FINANCEIROS
            ON DADOS_FINANCEIROS.DATAREF = DATA_PEDIDO AND DADOS_FINANCEIROS.UTD = PRINCIPAL.UTD AND DADOS_FINANCEIROS.ZONA = PRINCIPAL.ZONA AND ACAO = CARTEIRA